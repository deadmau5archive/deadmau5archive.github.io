const playPauseBtn=document.querySelector(".play-pause-btn"),theaterBtn=document.querySelector(".theater-btn"),fullScreenBtn=document.querySelector(".full-screen-btn"),miniPlayerBtn=document.querySelector(".mini-player-btn"),muteBtn=document.querySelector(".mute-btn"),captionsBtn=document.querySelector(".captions-btn"),speedBtn=document.querySelector(".speed-btn"),currentTimeElem=document.querySelector(".current-time"),totalTimeElem=document.querySelector(".total-time"),previewImg=document.querySelector(".preview-img"),previewTime=document.querySelector(".preview-time"),thumbnailImg=document.querySelector(".thumbnail-img"),volumeSlider=document.querySelector(".volume-slider"),videoContainer=document.querySelector(".video-container"),timelineContainer=document.querySelector(".timeline-container"),largebox=document.querySelector(".large-box"),videoControlsContainer=document.querySelector(".video-controls-container"),tTimeoutL2Preview=250,tTimeoutHideCursor=3e3;var wasPaused,video=null,audioMode=!1,isScrubbing=!1,hls=null,playerCfg=null,isHLS=!1,scrubbingDensity=0,scrubbingAtlas=null,scrubbingAtlasSize=0,scrubbingScheme=null,scrubbingAtlas2=null,scrubbingAtlasSize2=0,scrubbingScheme2=null;function postInit(){"video"==playerCfg.type?isHLS?((hls=new Hls).on(Hls.Events.MEDIA_ATTACHED,()=>{hls.loadSource(playerCfg.src)}),hls.attachMedia(video)):video.src=playerCfg.src:"audio"==playerCfg.type&&(video.src=playerCfg.src,"waveform"in playerCfg&&(largebox.classList.add("has-waveform"),largebox.style.backgroundImage="url('"+playerCfg.waveform+"')")),"start"in playerCfg&&(video.currentTime=playerCfg.start),"scrubbing"in playerCfg?(scrubbingDensity=playerCfg.scrubbing.density,scrubbingAtlas=playerCfg.scrubbing.atlas,scrubbingScheme=playerCfg.scrubbing.url,scrubbingAtlasSize=scrubbingAtlas.reduce((e,t)=>e*t,1),"url2"in playerCfg.scrubbing&&"atlas2"in playerCfg.scrubbing&&(scrubbingAtlas2=playerCfg.scrubbing.atlas2,scrubbingScheme2=playerCfg.scrubbing.url2,scrubbingAtlasSize2=scrubbingAtlas2.reduce((e,t)=>e*t,1))):videoContainer.classList.add("no-preview")}function toggleScrubbing(e){let t=timelineContainer.getBoundingClientRect(),i=Math.min(Math.max(0,e.x-t.x),t.width)/t.width;isScrubbing=(1&e.buttons)==1,videoContainer.classList.toggle("scrubbing",isScrubbing),isScrubbing?(wasPaused=video.paused,video.pause()):(video.currentTime=i*video.duration,wasPaused||video.play()),handleTimelineUpdate(e)}theaterBtn.remove(),captionsBtn.remove(),miniPlayerBtn.remove(),window.addEventListener("message",function(e){if("object"==typeof e.data){if("init"==e.data.type){if("video"==(playerCfg=e.data.data).type){if((video=document.createElement("video")).tabindex="-1",videoContainer.appendChild(video),"hls"in playerCfg&&playerCfg.hls){isHLS=!0;var t=document.createElement("script");t.onload=function(){Hls.isSupported()?playerInit():(videoContainer.innerHTML="",alert("error: hls is not supported"))},t.src="https://cdn.jsdelivr.net/npm/hls.js@latest",document.head.appendChild(t)}else playerInit()}else"audio"==playerCfg.type&&((video=document.createElement("audio")).tabindex="-1",videoContainer.appendChild(video),playerInit())}else"seek"==e.data.type&&video&&(video.currentTime=e.data.data)}});var loadL2Timeout=null,L2previews=[];function handleTimelineUpdate(e,t=!1){if(isNaN(video.duration))return;let i=timelineContainer.getBoundingClientRect(),n=Math.min(Math.max(0,e.x-i.x),i.width)/i.width,r=formatDuration(video.duration*n);var o=null,a=0,l=0,s=null,u=null;if(null!=scrubbingScheme2){let d=scrubbingDensity*scrubbingAtlasSize,c=Math.floor(n*video.duration/d)*d,g=Math.floor(n*video.duration/scrubbingDensity)%scrubbingAtlasSize;o=scrubbingScheme.replace("@offset",c.toString()),a=g%scrubbingAtlas[0],l=Math.floor(g/scrubbingAtlas[0]),s=scrubbingAtlas,u="L1T"+c}var v=null;if(null!=scrubbingScheme2){let m=scrubbingDensity*scrubbingAtlasSize2;v=Math.floor(n*video.duration/m)*m;let b=Math.floor(n*video.duration/scrubbingDensity)%scrubbingAtlasSize2,p=scrubbingScheme2.replace("@offset",v.toString()),y=b%scrubbingAtlas2[0],f=Math.floor(b/scrubbingAtlas2[0]);L2previews.includes(v)&&(o=p,a=y,l=f,s=scrubbingAtlas2,u="L2T"+v)}audioMode||null==o||(previewImg.dataset.previewImg!=u&&(previewImg.dataset.previewImg=u,previewImg.style.backgroundImage="url('"+o+"')",previewImg.style.backgroundSize=100*s[0]+"% "+100*s[1]+"%"),previewImg.style.backgroundPosition="-"+100*a+"% -"+100*l+"%"),timelineContainer.style.setProperty("--preview-position",n),previewTime.textContent=r,isScrubbing&&(e.preventDefault(),audioMode||null==o||(thumbnailImg.dataset.previewImg!=u&&(thumbnailImg.dataset.previewImg=u,thumbnailImg.style.backgroundImage="url('"+o+"')",thumbnailImg.style.backgroundSize=100*s[0]+"% "+100*s[1]+"%"),thumbnailImg.style.backgroundPosition="-"+100*a+"% -"+100*l+"%"),timelineContainer.style.setProperty("--progress-position",n),currentTimeElem.textContent=r),clearL2timeout(),t||null==v||(loadL2Timeout=setTimeout(()=>{L2previews.includes(v)||(L2previews.push(v),handleTimelineUpdate(e,!0))},250))}function clearL2timeout(){null!=loadL2Timeout&&(clearTimeout(loadL2Timeout),loadL2Timeout=null)}function changePlaybackSpeed(){let e=video.playbackRate+.25;e>2&&(e=.25),video.playbackRate=e,speedBtn.textContent=`${e}x`}const captions=null;function toggleCaptions(){if(null==captions)return;let e="hidden"===captions.mode;captions.mode=e?"showing":"hidden",videoContainer.classList.toggle("captions",e)}const leadingZeroFormatter=new Intl.NumberFormat(void 0,{minimumIntegerDigits:2});function formatDuration(e){let t=Math.floor(e%60),i=Math.floor(e/60)%60,n=Math.floor(e/3600);return 0===n?`${i}:${leadingZeroFormatter.format(t)}`:`${n}:${leadingZeroFormatter.format(i)}:${leadingZeroFormatter.format(t)}`}function skip(e){video.currentTime+=e}function toggleMute(){video.muted=!video.muted}function toggleTheaterMode(){videoContainer.classList.toggle("theater")}function toggleFullScreenMode(){null==document.fullscreenElement?videoContainer.requestFullscreen():document.exitFullscreen()}function toggleMiniPlayerMode(){videoContainer.classList.contains("mini-player")?document.exitPictureInPicture():video.requestPictureInPicture()}function togglePlay(){video.paused?video.play():video.pause()}var hideCursorTimeout=null;function cancelHideCursorTimeout(){videoContainer.classList.remove("hide-cursor"),null!=hideCursorTimeout&&(clearTimeout(hideCursorTimeout),hideCursorTimeout=null)}function playerInit(){document.addEventListener("keydown",e=>{let t=document.activeElement.tagName.toLowerCase();if("input"!==t)switch(e.key.toLowerCase()){case" ":if("button"===t)return;case"k":togglePlay();break;case"f":toggleFullScreenMode();break;case"t":case"i":break;case"m":toggleMute();break;case"arrowleft":skip(-5);break;case"j":skip(-10);break;case"arrowright":skip(5);break;case"l":skip(10)}}),timelineContainer.addEventListener("mousemove",handleTimelineUpdate),timelineContainer.addEventListener("mousedown",toggleScrubbing),timelineContainer.addEventListener("mouseleave",e=>{isScrubbing||clearL2timeout()}),document.addEventListener("mouseup",e=>{isScrubbing&&(toggleScrubbing(e),timelineContainer.parentNode.querySelector(":hover")!=timelineContainer&&clearL2timeout())}),document.addEventListener("mousemove",e=>{isScrubbing&&handleTimelineUpdate(e)}),speedBtn.addEventListener("click",changePlaybackSpeed),captionsBtn.addEventListener("click",toggleCaptions),video.addEventListener("loadeddata",()=>{totalTimeElem.textContent=formatDuration(video.duration),parent.postMessage({type:"duration",data:video.duration},"*")}),video.addEventListener("timeupdate",()=>{if(isScrubbing)return;currentTimeElem.textContent=formatDuration(video.currentTime);let e=video.currentTime/video.duration;timelineContainer.style.setProperty("--progress-position",e),parent.postMessage({type:"timeupdate",data:video.currentTime},"*")}),muteBtn.addEventListener("click",toggleMute),volumeSlider.addEventListener("input",e=>{video.volume=e.target.value,video.muted=0===e.target.value}),video.addEventListener("volumechange",()=>{volumeSlider.value=video.volume;let e;video.muted||0===video.volume?(muteBtn.title="unmute (m)",volumeSlider.value=0,e="muted"):(muteBtn.title="mute (m)",e=video.volume>=.5?"high":"low"),setCookie("player_volume",JSON.stringify({volume:video.volume,muted:video.muted})),videoContainer.dataset.volumeLevel=e}),theaterBtn.addEventListener("click",toggleTheaterMode),fullScreenBtn.addEventListener("click",toggleFullScreenMode),miniPlayerBtn.addEventListener("click",toggleMiniPlayerMode),document.addEventListener("fullscreenchange",()=>{videoContainer.classList.toggle("full-screen",document.fullscreenElement)}),video.addEventListener("enterpictureinpicture",()=>{videoContainer.classList.add("mini-player")}),video.addEventListener("leavepictureinpicture",()=>{videoContainer.classList.remove("mini-player")}),playPauseBtn.addEventListener("click",togglePlay),videoContainer.addEventListener("focusin",e=>{1==e.target.dataset.focusable&&videoContainer.classList.add("controls-focused")}),videoContainer.addEventListener("focusout",e=>{videoContainer.classList.remove("controls-focused")}),videoContainer.addEventListener("mouseleave",e=>{videoContainer.classList.remove("controls-focused"),cancelHideCursorTimeout()}),videoContainer.addEventListener("mousemove",e=>{cancelHideCursorTimeout(),videoControlsContainer.parentNode.querySelector(":hover")!=videoControlsContainer&&(hideCursorTimeout=setTimeout(()=>{videoContainer.classList.add("hide-cursor")},3e3))}),video.addEventListener("play",()=>{playPauseBtn.title="pause (k)",videoContainer.classList.remove("paused")}),video.addEventListener("pause",()=>{playPauseBtn.title="play (k)",videoContainer.classList.add("paused")});var e=video;"audio"==video.tagName.toLowerCase()&&(console.log("audio mode"),videoContainer.classList.add("audio-mode"),audioMode=!0,e=document.querySelector(".large-box"));var t=getCookie("player_volume");null!==t&&("volume"in(t=JSON.parse(t))&&(video.volume=t.volume),"muted"in t&&(video.muted=t.muted)),e.addEventListener("click",togglePlay),e.addEventListener("dblclick",toggleFullScreenMode),postInit()}function setCookie(e,t,i){var n="";if(i){var r=new Date;r.setTime(r.getTime()+864e5*i),n="; expires="+r.toUTCString()}document.cookie=e+"="+(t||"")+n+"; path=/"}function getCookie(e){for(var t=e+"=",i=document.cookie.split(";"),n=0;n<i.length;n++){for(var r=i[n];" "==r.charAt(0);)r=r.substring(1,r.length);if(0==r.indexOf(t))return r.substring(t.length,r.length)}return null}function eraseCookie(e){document.cookie=e+"=; Path=/; Expires=Thu, 01 Jan 1970 00:00:01 GMT;"}
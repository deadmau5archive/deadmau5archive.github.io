var itemsPerPage=50;function showAllTags(e,t){e.style.display="none";var a=document.getElementsByClassName(t);for(var i of a)i.style.display="inline-block"}function loadTags(e,t,a,i,l,s){getCategories(r=>{var n=-1;"filterTag"in l&&(n=l.filterTag);var o=function(e={},t=[]){var a=JSON.parse(JSON.stringify(l));if(s&&(a.p=1),null!=e)for(var i in e)a[i]=e[i];if(null!=t)for(var r of t)r in a&&delete a[r];return new URLSearchParams(a).toString()},c=[];for(var d in r){var f=r[d];f.id=d,c.push(f)}c.sort((e,t)=>t.count-e.count),c.sort(function(e,t){var a=e.id==n;return(t.id==n)-a});for(var g="",m=0;m<c.length;m++){var f=c[m],v=n==f.id;g+='<a class="tag searchTag'+(v?" active":"")+'" style="'+(m<10?"":"display:none;")+(v?"background:#"+f.color+";":"")+"border-color:#"+f.color+';" href="?'+o({filterTag:f.id})+'">'+escapeHtml(f.text)+' <i class="searchTagCount">'+f.count+"</i></a> "}c.length>10&&(g+='<a class="tag" href="#!" onclick="showAllTags(this, \'searchTag\')" title="show all tags">...</a> ');var p="&#10060;";n>0&&(g='<a class="tag" href="?'+o(null,["filterTag"])+'"><b style="color:#f00;">'+p+'</b><span class="tooltip">remove tag filter</span></a> '+g);var u="filterVis"in l?l.filterVis:"my",h="filterPltf"in l?l.filterPltf:null,b="filterYear"in l?l.filterYear:null,y="";Object.keys(l).length>0&&!(1==Object.keys(l).length&&"filterVis"==Object.keys(l)[0])&&(y='<div class="selectorGroup"><a href="?'+o(null,["filterPltf","filterYear","filterTag"])+'" class="selectorItem"><img src="/media/clear_all.png"> <span class="tooltip">remove all active filters</span></a></div> &emsp; ');for(var $="<b>Filter:</b> &emsp; "+y+'<div class="selectorGroup"><a href="?'+o({filterVis:"all"})+'" class="selectorItem '+("all"==u?"active":"")+'">\uD83D\uDD12 <span class="tooltip">show all videos</span></a><a href="?'+o({filterVis:"my"})+'" class="selectorItem '+("my"==u?"active":"")+'">\uD83D\uDC41️ <span class="tooltip">show videos visible to me ('+(null!=session?"<b>"+username+"</b>":"<i>guest</i>")+')</span></a><a href="?'+o({filterVis:"public"})+'"" class="selectorItem '+("public"==u?"active":"")+'">\uD83D\uDD13 <span class="tooltip">show public videos only</span></a></div> &emsp; <div class="selectorGroup">'+(null!=h?'<a href="?'+o(null,["filterPltf"])+'" class="selectorItem"><b style="color:#f00;">'+p+'</b><span class="tooltip">remove platform filter</span></a>':"")+'<a href="?'+o({filterPltf:"ttv"})+'" class="selectorItem '+("ttv"==h?"active":"")+'"><img src="/media/twitch.png"> <span class="tooltip">twitch</span></a><a href="?'+o({filterPltf:"mxr"})+'" class="selectorItem '+("mxr"==h?"active":"")+'"><img src="/media/mixer.png">️ <span class="tooltip">mixer</span></a><a href="?'+o({filterPltf:"m5tv"})+'" class="selectorItem '+("m5tv"==h?"active":"")+'"><img src="/media/favicon.png"> <span class="tooltip">mau5trap.tv</span></a></div> &emsp; <div class="selectorGroup">'+(null!=b?'<a href="?'+o(null,["filterYear"])+'" class="selectorItem"><b style="color:#f00;">'+p+'</b><span class="tooltip">remove year filter</span></a>':""),k=new Date().getFullYear(),_=k;_>=2015;_--)$+='<a href="?'+o({filterYear:_})+'" class="yearTag selectorItem '+(b==_?"active":"")+'" style="'+(_==k&&null==b||b==_?"":"display:none;")+'">'+_+"</a>";$+='<a href="#!" onclick="showAllTags(this, \'yearTag\')" class="selectorItem">...</a></div>&emsp; | &emsp;'+g,$+='<br><span class="searchResults">Showing <b>'+t+"</b> of <b>"+a+"</b> results. <i>"+(a-t)+" videos are hidden.</i>",document.getElementById("tagFilter").innerHTML=$;var x=function(t){fetch("/media/tag.min.svg").then(e=>e.text()).then(a=>{for(var i of(null==e&&(e=Object.keys(t)),e))if(i in t){var l=t[i],s=[];for(var n of l){var o=r[n];o.id=n,s.push(o)}var c=document.getElementById("tags_"+i);if(null!=c){var d=[],f="";s.sort((e,t)=>t.count-e.count);for(var g=[],m=0;m<5&&m<s.length;m++){d.push(s[m].text);var v="tgsvg_"+i+"_"+s[m].id+"_"+m+"_";f+='<div style="z-index:'+(1e3-m)+';overflow:visible;pointer-events:none;vertical-align:top;display:inline-block;width:8px;height:12px;"><div style="width:12px;height:12px;">'+a.replaceAll('id="','id="'+v)+"</div></div>",g.push({id:v+"tag",color:"#"+s[m].color})}for(var p of(c.innerHTML='<div style="display:inline-block;padding-right:6px;">'+f+"</div>"+(s.length>5?'<i style="opacity:0.4;">+'+(s.length-5)+"</i>":""),c.title="Tags: "+d.join(", ")+(s.length>5?" ("+(s.length-5)+" more)":""),c.style.display="inline-block",g))document.getElementById(p.id).style.fill=p.color}}})};null!=i?x(i):getTags(x)})}function getInfoTagsHtml(e){if(0==e.length)return"";var t="";for(var a of e)switch(a){case"ytb-some":t+='<img src="/media/ytb-some.png" class="icon" title="video blocked in some countries" /> ';break;case"ytb-all":t+='<img src="/media/ytb-all.png" class="icon" title="some audio removed to prevent block" /> ';break;case"error":t+='<img src="/media/nope.png" class="icon" title="could not be processed" /> ';break;case"muted":t+='<img src="/media/mute.png" class="icon" title="has muted segments" /> ';break;case"unmuted":t+='<img src="/media/unmuted.png" class="icon" title="has unmuted segments" /> ';break;case"discontinuity":t+='<img src="/media/warn.png" class="icon" title="has discontinuity errors" /> ';break;case"length":t+='<img src="/media/length.png" class="icon" title="length mismatch" /> ';break;case"lock":t+='<img src="/media/lock.png" class="icon" title="access restricted video" /> ';break;case"deleted":t+='<img src="/media/deleted.png" class="icon" title="this stream was deleted" /> '}return t}function loadFiltered(e,t){var a=new URL(window.location.href),i="",l={};for(var s of["filterTag","filterYear","filterPltf","filterVis"]){var r=a.searchParams.get(s);null!=r&&(isNaN(r)||(r=parseInt(r)),l[s]=r,i+="&"+s+"="+r)}if("filterTag"in l&&isNaN(l.filterTag)&&delete l.filterTag,"filterYear"in l&&isNaN(l.filterYear)&&delete l.filterYear,"filterPltf"in l&&"ustream"==l.filterPltf){window.location.href=atob("aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1kUXc0dzlXZ1hjUQ==");return}var n,o=null,c=0,d=function(e,t){getTags(a=>{o=a,e(t.filter(function(e){return!!(e.s in a&&a[e.s].includes(l.filterTag))}))})},f=function(e,t){e(t.filter(function(e){return"d"in e&&parseInt(e.d.substring(e.d.length-4,e.d.length))==l.filterYear}))},g=function(e,t){e(t.filter(function(e){if("t"in e){if("ttv"==l.filterPltf&&"T"==e.t)return!0;if("mxr"==l.filterPltf&&"M"==e.t)return!0;if("m5tv"==l.filterPltf&&"C"==e.t)return!0}return!1}))},m=function(e,t){var a="filterVis"in l?l.filterVis:"my",i=function(i){var l=!1,s=t;"all"!=a&&("public"==a&&(l=!0),"my"==a&&null==session&&(l=!0),s=t.filter(function(e){if(!("a"in e&&null!=e.a&&e.a.length>0))return!0;if(l)return!1;if("my"==a&&null!=session){for(var t of e.a)if(i.includes(t))return!0}return!1})),e(s)},s=()=>i([]);"my"==a&&(s=()=>waitforSession(()=>{null!=session?getUserGroups(e=>{var t=[];for(var a of e.groups)t.push(a.id);i(t)}):i([])})),s()},v=e=>{t(e,i,c,o,l)},p="filterTag"in l?e=>d(v,e):v,u="filterYear"in l?e=>f(p,e):p,h="filterPltf"in l?e=>g(u,e):u,b=e=>m(h,e);c=(n=e).length,b(n)}function loadPages(){var e,t,a=new URL(window.location.href).searchParams.get("p"),i=(t=e=a,function(e,a,i,l,s){var r=Math.ceil(e.length/itemsPerPage),n=0,o=0,c=0,d=!1,f=[];if("all"==t){d=!0,o=e.length;var g=document.getElementById("pagesAllToggle");g.innerHTML="Show pages",g.href="/page?p=1"}else isNaN(t)||(n=(c=parseInt(t)-1)*itemsPerPage,o=Math.min(e.length,n+itemsPerPage));if(n>=0&&n<e.length){for(var m=e.slice(n,o),v="",p=[],u=0;u<m.length;u++){var h=m[u],b="";"T"==h.t?b='<img src="/media/twitch.png" class="icon" title="streamed on twitch">':"M"==h.t?b='<img src="/media/mixer.png" class="icon" title="streamed on mixer">':"C"==h.t&&(b='<img src="/media/favicon.png" class="icon" title="streamed on mau5trap.tv">');var y='<span class="title">'+("h"in h&&null!=h.h?escapeHtml(h.h):'<i style="opacity:0.4;" title="no original title specified">deadmau5 livestream</i>')+"</span>";y+='<span class="vidno">'+b+("n"in h&&null!=h.n?" "+h.n:"")+"</span><br>",y+='<span class="game">'+("c"in h&&null!=h.c?escapeHtml(h.c):"")+"</span>";var $="/media/default_thumbs/default.png";1==h.i?$=staticUrl+"thumb/"+h.s+".jpg":2==h.i&&($="/media/default_thumbs/not_yet_uploaded.png");var k='<div class="thumbnailContainer thumbnailContainerShade"></div>';1==h.b?k='<div class="thumbnailContainer"><div class="thumbnail thumbnailAnimated"><img src="'+staticUrl+"storyboard/"+h.s+'.jpg" /></div></div>':2==h.b&&(k='<div class="thumbnailContainer"><div id="scrubbingPreview_'+h.s+'" class="thumbnailContainerScrubbingPreview"></div></div>',p.push(h.s));var _=getInfoTagsHtml(h.g).trim();_=""!=_?'<div class="overlaybox lblcontainer">'+_+"</div>":"";var x='<div class="preview">'+('<div class="thumbnail"><div class="previewImg" style="background: url(\''+$+"');\"></div></div>"+k+'<div class="overlaybox timecontainer"><img src="/media/play.png"> '+h.r+'</div><div class="overlaybox datecontainer">'+h.d+'</div><div id="tags_'+h.s+'" class="overlaybox tagcontainer"></div>')+_+'</div><div class="textbox">'+y+"</div>";v+='<a href="/videos/'+h.s+'"><div class="vidbox">'+x+"</div></a>",f.push(h.s)}for(var w of(document.getElementById("page_videos").innerHTML=v,p)){let T=w,P=document.getElementById("scrubbingPreview_"+T);P.addEventListener("mouseenter",e=>{if(void 0===P.dataset.state){P.dataset.state="loading";var t=new Image;t.src=staticUrl+"preview/"+T+".webp",t.onload=function(){P.style.background="url('"+t.src+"')",P.style.backgroundSize="1500px 840px",P.dataset.state="loaded"}}P.style.backgroundPosition="0px 0px"}),P.addEventListener("mouseleave",e=>{P.style.backgroundPosition="0px 0px"}),P.addEventListener("mousemove",e=>{if("loaded"===P.dataset.state){var t=e.target.getBoundingClientRect(),a=Math.floor((e.clientX-t.left)*25/300);P.style.backgroundPosition="-"+a%5*300+"px -"+168*Math.floor(a/5)+"px"}})}}var I="";if(!d)for(var u=0;u<r;u++)I+='<a href="/page?p='+(u+1)+a+'" class="btn'+(u==c?" active":"")+'">'+(u+1)+"</a> ";document.getElementById("page_buttons").innerHTML=I;var L="";L=d?"All videos":(c-1>=0?'<a href="/page?p='+c+a+'" class="btn">&#9664;</a>&emsp;':"")+"Page <b>"+(c+1)+"</b> of <b>"+r+"</b>&emsp;"+(c+1<r?'<a href="/page?p='+(c+2)+a+'" class="btn">&#9654;</a>':""),document.getElementById("page_info").innerHTML=L,loadTags(f,e.length,i,l,s,!0)});null!=a?getVideoList(e=>{loadFiltered(e.videos,i)}):window.location.href="/page?p=1"}function loadList(){var e=function(e,t,a,i,l){for(var s=[],r="",n=0;n<e.length;n++){var o=e[n],c="";"T"==o.t?c='<img src="/media/twitch.png" class="icon" title="streamed on twitch">':"M"==o.t?c='<img src="/media/mixer.png" class="icon" title="streamed on mixer">':"C"==o.t&&(c='<img src="/media/favicon.png" class="icon" title="streamed on mau5trap.tv">');var d="/media/default_thumbs/default.png";1==o.i?d=staticUrl+"thumb/"+o.s+".jpg":2==o.i&&(d="/media/default_thumbs/not_yet_uploaded.png");for(var f=getInfoTagsHtml(o.g),g=o,m=g.o,v=[],p=g.p,u=0;u<p;u++){var h=g.y[u],b="";b=p>1?'<a href="/videos/'+o.s+"/"+(u+1)+'" class="btn">Part '+(u+1)+"</a>":'<a href="/videos/'+o.s+'" class="btn">Watch</a>',null!=h&&(b+=' <a href="https://www.youtube.com/watch?v='+h+'" target="_blank"><img src="/media/yt.png" class="ytLink" /></a>'),v.push(b)}var y="";if(g.m){var $=g.m;y="<div style=\"background-image: url('"+staticUrl+"thumbmaps/map-"+$[0]+".png'); background-position: "+$[1]+"px "+$[2]+'px;" class="thumbmapped-8-16">'}else y="<div style=\"background-image: url('"+d+'\');" class="thumb">';var k=g.td+"&ensp;"+(g.ta?'<span title="approx.">~</span>':"")+g.tt,_="n"in o&&null!=o.n?o.n:"",x="h"in o&&null!=o.h?"<b>"+escapeHtml(o.h)+"</b>":'<i style="opacity:0.4;" title="no original title specified">deadmau5 livestream</i>',w="c"in o&&null!=o.c?escapeHtml(o.c):'<span title="no category">--</span>';r+='<tr class="listtableRow" data-v="'+o.s+'" data-offsets="'+m.join(",")+'"><td>'+y+'</td><td><i class="no">'+c+" "+_+"</i><br>"+f+"</td><td>"+x+' <div class="listTags" id="tags_'+o.s+'"></div><br><span class="game">'+w+'</span><br><div class="listMarkerList" id="markers_'+o.s+'"></div></td><td><img src="/media/play.png" class="icon" /> '+o.r+"<br><i>"+k+"</i></td><td>"+v.join("&emsp;")+"</td></tr>",s.push(o.s)}document.getElementById("listtable").innerHTML=r,document.getElementById("markerListSelectContainer").style.display="block",document.getElementById("markerListSelect").value="none",loadTags(s,e.length,a,i,l,!1)};getVideoListExtra(t=>{loadFiltered(t.videos,e)})}function listShowMarkers(){var e=document.getElementsByClassName("listMarkerList"),t=document.getElementById("markerListSelect"),a=t.value;if("none"!=a){for(var i of e)i.style.display="block";var l=function(e){for(var t in e){var i=e[t],l="",s=0;for(var r of i){var n=!1;if(null!=username&&username==r.by&&(n=!0),("comm"!=a||!n)&&("my"!=a||n)){var o=r.by,c=escapeHtml(r.text),d='<div style="vertical-align:baseline;display:inline-block;width:10px;height:10px;background:#'+r.color+';border-radius:6px;"></div>';n&&(o='<span title="you" style="color:#47f;">'+o+"</span>");var f=r.offset;l+='<div><a class="timestamp" href="/videos/'+t+"?t="+f+'">'+toTimestamp(f)+"</a>&ensp;"+d+"&emsp;"+c+'&emsp;<i style="color:gray;">by '+o+"</i></div>",s++}}l=s>0?'<hr style="border:none;border-top: 1px solid #333;"><b>Markers</b> ('+s+"):<br> "+l:"";var g=document.getElementById("markers_"+t);g&&(g.innerHTML=l)}};null==listMarkerList?(t.disabled=!0,getMarkers(e=>{listMarkerList=e,t.disabled=!1,l(e)})):l(listMarkerList)}else for(var i of e)i.style.display="none"}listMarkerList=null;
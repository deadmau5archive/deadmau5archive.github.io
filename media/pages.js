var itemsPerPage=50;function showAllTags(e,t){e.style.display="none";var a=document.getElementsByClassName(t);for(var i of a)i.style.display="inline-block"}function loadTags(e,t,a,i,l,s){getCategories(r=>{var n=-1;"filterTag"in l&&(n=l.filterTag);var o=function(e={},t=[]){var a=JSON.parse(JSON.stringify(l));if(s&&(a.p=1),null!=e)for(var i in e)a[i]=e[i];if(null!=t)for(var r of t)r in a&&delete a[r];return new URLSearchParams(a).toString()},c=[];for(var d in r){var f=r[d];f.id=d,c.push(f)}c.sort((e,t)=>t.count-e.count),c.sort(function(e,t){var a=e.id==n;return(t.id==n)-a});for(var m="",g=0;g<c.length;g++){var f=c[g],v=n==f.id;m+='<a class="tag searchTag'+(v?" active":"")+'" style="'+(g<10?"":"display:none;")+(v?"background:#"+f.color+";":"")+"border-color:#"+f.color+';" href="?'+o({filterTag:f.id})+'">'+escapeHtml(f.text)+' <i class="searchTagCount">'+f.count+"</i></a> "}c.length>10&&(m+='<a class="tag" href="#!" onclick="showAllTags(this, \'searchTag\')" title="show all tags">...</a> ');var p="&#10060;";n>0&&(m='<a class="tag" href="?'+o(null,["filterTag"])+'"><b style="color:#f00;">'+p+'</b><span class="tooltip">remove tag filter</span></a> '+m);var u="filterVis"in l?l.filterVis:"my",h="filterPltf"in l?l.filterPltf:null,b="filterYear"in l?l.filterYear:null,y="";Object.keys(l).length>0&&!(1==Object.keys(l).length&&"filterVis"==Object.keys(l)[0])&&(y='<div class="selectorGroup"><a href="?'+o(null,["filterPltf","filterYear","filterTag"])+'" class="selectorItem"><img src="/media/clear_all.png"> <span class="tooltip">remove all active filters</span></a></div> &emsp; ');for(var $="<b>Filter:</b> &emsp; "+y+'<div class="selectorGroup"><a href="?'+o({filterVis:"all"})+'" class="selectorItem '+("all"==u?"active":"")+'">\uD83D\uDD12 <span class="tooltip">show all videos</span></a><a href="?'+o({filterVis:"my"})+'" class="selectorItem '+("my"==u?"active":"")+'">\uD83D\uDC41️ <span class="tooltip">show videos visible to me ('+(null!=session?"<b>"+username+"</b>":"<i>guest</i>")+')</span></a><a href="?'+o({filterVis:"public"})+'"" class="selectorItem '+("public"==u?"active":"")+'">\uD83D\uDD13 <span class="tooltip">show public videos only</span></a></div> &emsp; <div class="selectorGroup">'+(null!=h?'<a href="?'+o(null,["filterPltf"])+'" class="selectorItem"><b style="color:#f00;">'+p+'</b><span class="tooltip">remove platform filter</span></a>':"")+'<a href="?'+o({filterPltf:"ttv"})+'" class="selectorItem '+("ttv"==h?"active":"")+'"><img src="/media/twitch.png"> <span class="tooltip">twitch</span></a><a href="?'+o({filterPltf:"mxr"})+'" class="selectorItem '+("mxr"==h?"active":"")+'"><img src="/media/mixer.png">️ <span class="tooltip">mixer</span></a><a href="?'+o({filterPltf:"m5tv"})+'" class="selectorItem '+("m5tv"==h?"active":"")+'"><img src="/media/favicon.png"> <span class="tooltip">mau5trap.tv</span></a></div> &emsp; <div class="selectorGroup">'+(null!=b?'<a href="?'+o(null,["filterYear"])+'" class="selectorItem"><b style="color:#f00;">'+p+'</b><span class="tooltip">remove year filter</span></a>':""),k=new Date().getFullYear(),T=k;T>=2015;T--)$+='<a href="?'+o({filterYear:T})+'" class="yearTag selectorItem '+(b==T?"active":"")+'" style="'+(T==k&&null==b||b==T?"":"display:none;")+'">'+T+"</a>";$+='<a href="#!" onclick="showAllTags(this, \'yearTag\')" class="selectorItem">...</a></div>&emsp; | &emsp;'+m,$+='<br><span class="searchResults">Showing <b>'+t+"</b> of <b>"+a+"</b> results. <i>"+(a-t)+" videos are hidden.</i>",document.getElementById("tagFilter").innerHTML=$;var _=function(t){fetch("/media/tag.min.svg").then(e=>e.text()).then(a=>{for(var i of(null==e&&(e=Object.keys(t)),e))if(i in t){var l=t[i],s=[];for(var n of l){var o=r[n];o.id=n,s.push(o)}var c=document.getElementById("tags_"+i);if(null!=c){var d=[],f="";s.sort((e,t)=>t.count-e.count);for(var m=[],g=0;g<5&&g<s.length;g++){d.push(s[g].text);var v="tgsvg_"+i+"_"+s[g].id+"_"+g+"_";f+='<div style="z-index:'+(1e3-g)+';overflow:visible;pointer-events:none;vertical-align:top;display:inline-block;width:8px;height:12px;"><div style="width:12px;height:12px;">'+a.replaceAll('id="','id="'+v)+"</div></div>",m.push({id:v+"tag",color:"#"+s[g].color})}for(var p of(c.innerHTML='<div style="display:inline-block;padding-right:6px;">'+f+"</div>"+(s.length>5?'<i style="opacity:0.4;">+'+(s.length-5)+"</i>":""),c.title="Tags: "+d.join(", ")+(s.length>5?" ("+(s.length-5)+" more)":""),c.style.display="inline-block",m))document.getElementById(p.id).style.fill=p.color}}})};null!=i?_(i):getTags(_)})}function getInfoTagsHtml(e){if(0==e.length)return"";var t="";for(var a of e)switch(a){case"ytb-some":t+='<img src="/media/ytb-some.png" class="icon" title="video blocked in some countries" /> ';break;case"ytb-all":t+='<img src="/media/ytb-all.png" class="icon" title="some audio removed to prevent block" /> ';break;case"error":t+='<img src="/media/nope.png" class="icon" title="could not be processed" /> ';break;case"muted":t+='<img src="/media/mute.png" class="icon" title="has muted segments" /> ';break;case"unmuted":t+='<img src="/media/unmuted.png" class="icon" title="has unmuted segments" /> ';break;case"discontinuity":t+='<img src="/media/warn.png" class="icon" title="has discontinuity errors" /> ';break;case"length":t+='<img src="/media/length.png" class="icon" title="length mismatch" /> ';break;case"lock":t+='<img src="/media/lock.png" class="icon" title="access restricted video" /> ';break;case"deleted":t+='<img src="/media/deleted.png" class="icon" title="this stream was deleted" /> '}return t}function loadFiltered(e){var t=new URL(window.location.href),a="",i={};for(var l of["filterTag","filterYear","filterPltf","filterVis"]){var s=t.searchParams.get(l);null!=s&&(isNaN(s)||(s=parseInt(s)),i[l]=s,a+="&"+l+"="+s)}"filterTag"in i&&isNaN(i.filterTag)&&delete i.filterTag,"filterYear"in i&&isNaN(i.filterYear)&&delete i.filterYear;var r=null,n=0,o=function(e,t){getTags(a=>{r=a,e(t.filter(function(e){return!!(e.s in a&&a[e.s].includes(i.filterTag))}))})},c=function(e,t){e(t.filter(function(e){return"d"in e&&parseInt(e.d.substring(e.d.length-4,e.d.length))==i.filterYear}))},d=function(e,t){e(t.filter(function(e){if("t"in e){if("ttv"==i.filterPltf&&"T"==e.t)return!0;if("mxr"==i.filterPltf&&"M"==e.t)return!0;if("m5tv"==i.filterPltf&&"C"==e.t)return!0}return!1}))},f=function(e,t){var a="filterVis"in i?i.filterVis:"my",l=function(i){var l=!1,s=t;"all"!=a&&("public"==a&&(l=!0),"my"==a&&null==session&&(l=!0),s=t.filter(function(e){if(!("a"in e&&null!=e.a&&e.a.length>0))return!0;if(l)return!1;if("my"==a&&null!=session){for(var t of e.a)if(i.includes(t))return!0}return!1})),e(s)},s=()=>l([]);"my"==a&&(s=()=>waitforSession(()=>{null!=session?getUserGroups(e=>{var t=[];for(var a of e.groups)t.push(a.id);l(t)}):l([])})),s()},m=t=>{e(t,a,n,r,i)},g="filterTag"in i?e=>o(m,e):m,v="filterYear"in i?e=>c(g,e):g,p="filterPltf"in i?e=>d(v,e):v,u=e=>f(p,e),h=e=>{n=e.length,u(e)};load("/data/pages.json?nc="+Date.now(),h)}function loadPages(){var e,t,a=new URL(window.location.href).searchParams.get("p"),i=(t=e=a,function(e,a,i,l,s){var r=Math.ceil(e.length/itemsPerPage),n=0,o=0,c=0,d=!1,f=[];if("all"==t){d=!0,o=e.length;var m=document.getElementById("pagesAllToggle");m.innerHTML="Show pages",m.href="/page?p=1"}else isNaN(t)||(n=(c=parseInt(t)-1)*itemsPerPage,o=Math.min(e.length,n+itemsPerPage));if(n>=0&&n<e.length){for(var g=e.slice(n,o),v="",p=0;p<g.length;p++){var u=g[p],h="";"T"==u.t?h='<img src="/media/twitch.png" class="icon" title="streamed on twitch">':"M"==u.t?h='<img src="/media/mixer.png" class="icon" title="streamed on mixer">':"C"==u.t&&(h='<img src="/media/favicon.png" class="icon" title="streamed on mau5trap.tv">');var b='<span class="title">'+("h"in u&&null!=u.h?escapeHtml(u.h):'<i style="opacity:0.4;" title="no original title specified">deadmau5 livestream</i>')+"</span>";b+='<span class="vidno">'+h+("n"in u&&null!=u.n?" "+u.n:"")+"</span><br>",b+='<span class="game">'+("c"in u&&null!=u.c?escapeHtml(u.c):"")+"</span>";var y="/media/default_thumbs/default.png";1==u.i?y=staticUrl+"thumb/"+u.s+".jpg":2==u.i&&(y="/media/default_thumbs/not_yet_uploaded.png");var $='<div class="thumbnailContainer thumbnailContainerShade"></div>';1==u.b&&($='<div class="thumbnailContainer"><div class="thumbnail thumbnailAnimated"><img src="'+staticUrl+"storyboard/"+u.s+'.jpg" /></div></div>');var k=getInfoTagsHtml(u.g).trim();k=""!=k?'<div class="overlaybox lblcontainer">'+k+"</div>":"";var T='<div class="preview">'+('<div class="thumbnail"><div class="previewImg" style="background: url(\''+y+"');\"></div></div>"+$+'<div class="overlaybox timecontainer"><img src="/media/play.png"> '+u.r+'</div><div class="overlaybox datecontainer">'+u.d+'</div><div id="tags_'+u.s+'" class="overlaybox tagcontainer"></div>')+k+'</div><div class="textbox">'+b+"</div>";v+='<a href="/videos/'+u.s+'"><div class="vidbox">'+T+"</div></a>",f.push(u.s)}document.getElementById("page_videos").innerHTML=v}var _="";if(!d)for(var p=0;p<r;p++)_+='<a href="/page?p='+(p+1)+a+'" class="btn'+(p==c?" active":"")+'">'+(p+1)+"</a> ";document.getElementById("page_buttons").innerHTML=_;var w="";w=d?"All videos":(c-1>=0?'<a href="/page?p='+c+a+'" class="btn">&#9664;</a>&emsp;':"")+"Page <b>"+(c+1)+"</b> of <b>"+r+"</b>&emsp;"+(c+1<r?'<a href="/page?p='+(c+2)+a+'" class="btn">&#9654;</a>':""),document.getElementById("page_info").innerHTML=w,loadTags(f,e.length,i,l,s,!0)});null!=a?loadFiltered(i):window.location.href="/page?p=1"}function loadList(){loadFiltered(function(e,t,a,i,l){for(var s=[],r="",n=0;n<e.length;n++){var o=e[n],c="";"T"==o.t?c='<img src="/media/twitch.png" class="icon" title="streamed on twitch">':"M"==o.t?c='<img src="/media/mixer.png" class="icon" title="streamed on mixer">':"C"==o.t&&(c='<img src="/media/favicon.png" class="icon" title="streamed on mau5trap.tv">');var d="/media/default_thumbs/default.png";1==o.i?d=staticUrl+"thumb/"+o.s+".jpg":2==o.i&&(d="/media/default_thumbs/not_yet_uploaded.png");for(var f=getInfoTagsHtml(o.g),m=listMetadata[o.s],g=m.o,v=[],p=m.p,u=0;u<p;u++){var h=m.y[u],b="";b=p>1?'<a href="/videos/'+o.s+"/"+(u+1)+'" class="btn">Part '+(u+1)+"</a>":'<a href="/videos/'+o.s+'" class="btn">Watch</a>',null!=h&&(b+=' <a href="https://www.youtube.com/watch?v='+h+'" target="_blank"><img src="/media/yt.png" class="ytLink" /></a>'),v.push(b)}var y="";if(m.m){var $=m.m;y="<div style=\"background-image: url('"+staticUrl+"thumbmaps/map-"+$[0]+".png'); background-position: "+$[1]+"px "+$[2]+'px;" class="thumbmapped-8-16">'}else y="<div style=\"background-image: url('"+d+'\');" class="thumb">';var k=m.td+"&ensp;"+(m.ta?'<span title="approx.">~</span>':"")+m.tt,T="n"in o&&null!=o.n?o.n:"",_="h"in o&&null!=o.h?"<b>"+escapeHtml(o.h)+"</b>":'<i style="opacity:0.4;" title="no original title specified">deadmau5 livestream</i>',w="c"in o&&null!=o.c?escapeHtml(o.c):'<span title="no category">--</span>';r+='<tr class="listtableRow" data-v="'+o.s+'" data-offsets="'+g.join(",")+'"><td>'+y+'</td><td><i class="no">'+c+" "+T+"</i><br>"+f+"</td><td>"+_+' <div class="listTags" id="tags_'+o.s+'"></div><br><span class="game">'+w+'</span><br><div class="listMarkerList" id="markers_'+o.s+'"></div></td><td><img src="/media/play.png" class="icon" /> '+o.r+"<br><i>"+k+"</i></td><td>"+v.join("&emsp;")+"</td></tr>",s.push(o.s)}document.getElementById("listtable").innerHTML=r,document.getElementById("markerListSelectContainer").style.display="block",document.getElementById("markerListSelect").value="none",loadTags(s,e.length,a,i,l,!1)})}function listShowMarkers(){var e=document.getElementsByClassName("listMarkerList"),t=document.getElementById("markerListSelect"),a=t.value;if("none"!=a){for(var i of e)i.style.display="block";var l=function(e){var t=document.getElementsByClassName("listtableRow"),i={};for(var l of t)i[l.dataset.v]=l.dataset.offsets.split(",").map(e=>parseInt(e));var s={};for(var r in e){var n=r.split("/"),o=n[0];for(var c of(o in s||(s[o]=[]),e[r])){var d=parseInt(n[1]);c.link=o,o in i&&d<i[o].length&&(c.offset_p=c.offset+i[o][d]),s[o].push(c)}}for(var r in s){var f=s[r],m="",g=0;for(var c of f){var v=!1;if(null!=username&&username==c.by&&(v=!0),("comm"!=a||!v)&&("my"!=a||v)){var p=c.by,u=escapeHtml(c.text),h='<div style="vertical-align:baseline;display:inline-block;width:10px;height:10px;background:#'+c.color+';border-radius:6px;"></div>';v&&(p='<span title="you" style="color:#47f;">'+p+"</span>");var b="offset_p"in c?c.offset_p:c.offset;m+='<div><a class="timestamp" href="/videos/'+c.link+"?t="+b+'">'+toTimestamp(b)+"</a>&ensp;"+h+"&emsp;"+u+'&emsp;<i style="color:gray;">by '+p+"</i></div>",g++}}m=g>0?'<hr style="border:none;border-top: 1px solid #333;"><b>Markers</b> ('+g+"):<br> "+m:"";var y=document.getElementById("markers_"+r);y&&(y.innerHTML=m)}};null==listMarkerList?(t.disabled=!0,getMarkers(e=>{listMarkerList=e,t.disabled=!1,l(e)})):l(listMarkerList)}else for(var i of e)i.style.display="none"}listMarkerList=null;
var loginComment="please log in to manage your account connection",url=new URL(window.location.href),tokenParam=url.searchParams.get("t");function loadConnectedAccount(){discordAccountGet(n=>{var o=n.connected,e=n.account,c="";for(var t of n.groups)c+='<span style="display: inline-block; padding:5px 10px; border-radius: 20px; border: 1px solid #'+t.color+';">'+escapeHtml(t.name)+"</span> ";""==c&&(c='<i style="opacity: 0.6;">(none)</i>');var i="";i=o?'<div class="infobox infobox-success"> ✔️ Connected to discord account: <br> <b>'+escapeHtml(e.name)+"</b> <br> ID: <i>"+e.id+"</i> <br><br> <hr> <br> <b>User groups</b><br>You have access to the following user groups:<br> "+c+' <br><br> <a href="#!" onclick="resyncAccount();" style="color:#888;font-size:small;" title="refresh username and user roles">re-sync</a> <a href="#!" onclick="disconnect();" style="color:#a00;font-size:small;" title="remove your account connection">disconnect</a> </div>':'<div class="infobox infobox-gray"> ❌ your account is not connected to discord. </div>',document.getElementById("connection_details").innerHTML=i})}function loadPageContent(){document.getElementById("pre-login").style.display="none",document.getElementById("content").style.display="block",null!=tokenParam?discordAccountConnect(tokenParam,n=>{var o=n.connected;connection_details=o?'<div class="infobox infobox-success-full"><b>Account successfully connected!</b></div>':'<div class="infobox infobox-error"><b>Error!</b> <i>This token is not valid or has expired.</i></div>',document.getElementById("new_connection_details").innerHTML=connection_details+"<br><br>",o?resyncCallback(n=>{loadConnectedAccount()}):loadConnectedAccount()}):loadConnectedAccount()}function loginCallback(n){n?loadPageContent():document.getElementById("pre-login").innerHTML="<h2>Please log in</h2> <br> <p>"+loginComment+'</p> <br> <a class="shade" href="#!" onclick="connectionsShowLogin()">Login</a>'}function connectionsShowLogin(){session?loadPageContent():showLoginPane(loginComment,loginCallback)}function disconnect(){confirm("are you sure?")&&discordAccountDisconnect(n=>{connection_details=n.disconnected?'<div class="infobox infobox-success-full"><b>Account successfully disconnected!</b></div>':'<div class="infobox infobox-error"><b>Error:<b> something went wrong</div>',document.getElementById("new_connection_details").innerHTML=connection_details+"<br><br>",loadConnectedAccount()})}function resyncCallback(n){discordAccountResync(o=>{null!=o&&"wait"in o&&mkToast("ERROR: you're doing that too often - please wait "+o.wait+"s","f55"),n(null!=o&&"resynced"in o&&!0==o.resynced)})}function resyncAccount(){resyncCallback(n=>{n&&(loadConnectedAccount(),mkToast("successfully re-synced your account!","0a0"))})}null!=tokenParam&&(loginComment="please log in to connect your account"),waitforSession(()=>{connectionsShowLogin()});
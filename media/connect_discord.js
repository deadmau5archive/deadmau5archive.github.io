var loginComment="please log in to manage your account connection",url=new URL(window.location.href),tokenParam=url.searchParams.get("t");function loadConnectedAccount(){discordAccountGet(b=>{var f=b.connected,c=b.account,a="";for(var d of b.groups)a+='<span style="display: inline-block; padding:5px 10px; border-radius: 20px; border: 1px solid #'+d.color+';">'+escapeHtml(d.name)+"</span> ";""==a&&(a='<i style="opacity: 0.6;">(none)</i>');var e="";e=f?'<div class="infobox infobox-success"> \u2714\uFE0F Connected to discord account: <br> <b>'+escapeHtml(c.name)+"</b> <br> ID: <i>"+c.id+"</i> <br><br> <hr> <br> <b>User groups</b><br>You have access to the following user groups:<br> "+a+' <br><br> <a href="#!" onclick="resyncAccount();" style="color:#888;font-size:small;" title="refresh username and user roles">re-sync</a> <a href="#!" onclick="disconnect();" style="color:#a00;font-size:small;" title="remove your account connection">disconnect</a> </div>':'<div class="infobox infobox-gray"> \u274C your account is not connected to discord. </div>',document.getElementById("connection_details").innerHTML=e})}function loadPageContent(){document.getElementById("pre-login").style.display="none",document.getElementById("content").style.display="block",null!=tokenParam?discordAccountConnect(tokenParam,b=>{var a=b.connected;connection_details=a?'<div class="infobox infobox-success-full"><b>Account successfully connected!</b></div>':'<div class="infobox infobox-error"><b>Error!</b> <i>This token is not valid or has expired.</i></div>',document.getElementById("new_connection_details").innerHTML=connection_details+"<br><br>",a?discordAccountResync(()=>{loadConnectedAccount()}):loadConnectedAccount()}):loadConnectedAccount()}function loginCallback(a){a?loadPageContent():document.getElementById("pre-login").innerHTML="<h2>Please log in</h2> <br> <p>"+loginComment+'</p> <br> <a class="shade" href="#!" onclick="connectionsShowLogin()">Login</a>'}function connectionsShowLogin(){session?loadPageContent():showLoginPane(loginComment,loginCallback)}function disconnect(){confirm("are you sure?")&&discordAccountDisconnect(a=>{connection_details=a.disconnected?'<div class="infobox infobox-success-full"><b>Account successfully disconnected!</b></div>':'<div class="infobox infobox-error"><b>Error:<b> something went wrong</div>',document.getElementById("new_connection_details").innerHTML=connection_details+"<br><br>",loadConnectedAccount()})}function resyncAccount(){discordAccountResync(()=>{loadConnectedAccount(),mkToast("successfully re-synced your account!","0a0")})}null!=tokenParam&&(loginComment="please log in to connect your account"),waitforSession(()=>{connectionsShowLogin()})
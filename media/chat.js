function load(e,t){var a=new XMLHttpRequest;a.open("GET",e,!0),a.responseType="json",a.onload=function(){200===a.status&&t(a.response)},a.send()}var toTimestamp=e=>{var t=parseInt(e,10);return[Math.floor(t/3600)%24,Math.floor(t/60)%60,t%60].map(e=>e<10?"0"+e:e).join(":")},badgeIndex=null,chatTimestampLink="?t=";function renderSingleMessage(e){content="<div>";var t=Math.floor(e.t)-chatOffset;return content+='<a class="timestamp" href="'+chatTimestampLink+t+'" onclick="return jumpTo('+t+');">'+toTimestamp(t)+"</a>&ensp;",null!=e.b&&null!=badgeIndex&&(null!=e.l&&0==e.l&&(content+='<img title="message was posted after live recording" alt="VOD" src="/media/vodBadge.png"> '),e.b.forEach(e=>{var t=badgeIndex[e.i][e.v];content+='<img title="'+t.title+'" alt="'+t.title+'" src="'+t.img+'"> '})),content+='<a target="_blank" href="https://www.twitch.tv/'+e.n.toLowerCase()+'" style="text-decoration: none; color:#'+(null!=e.s?e.s:"aaa")+';"><b>'+e.n+"</b></a>:&ensp;",e.c.forEach(e=>{null!=e.t?content+=escapeHtml(e.t):null!=e.e?content+='<img title="'+e.a+'" alt="'+e.a+'" src="https://static-cdn.jtvnw.net/emoticons/v1/'+e.e+'/1.0">':null!=e.m&&(content+='<a class="shade" target="_blank" href="https://www.twitch.tv/'+e.m.toLowerCase()+'">@'+e.m+"</a>")}),content+="</div>",content}function escapeHtml(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}var chatElement,chatMessages,numChatMessages,playerSeek=!1;function jumpTo(e){if(playerSeek)return console.log("seekTo: "+e),player.seekTo(e),!1}function displayChat(e,t,a,s=0){load("/comments/"+e+".txt",function(n){if(a&&(chatTimestampLink="/videos/"+e+"?t="),console.log("caht"),load("/chat/badge_index.txt",function(e){badgeIndex=e;var l=new URL(window.location.href).searchParams.get("vodchat"),o=!1;if(null!=l&&"1"==l&&(o=!0),!a&&o&&null!=document.getElementById("vodChatLbl")&&(document.getElementById("vodChatLbl").innerHTML='<i style="color: #666;">(VOD chat is enabled)</i>'),a)displayChatFull(t,n,o);else{chatElement=t,chatMessages=[];for(var r=0;r<n.length;r++){var c=n[r];(null==c.l||0!=c.l||o)&&chatMessages.push(c)}numChatMessages=chatMessages.length,chatOffset=s,playerSeek=!0,null!=player&&(chatPlayback(),setInterval(chatPlayback,500))}}),a){var l=document.getElementById("topBtn");l.href="/videos/"+e,l.innerHTML="Go to video"}})}var messageIndex,lastSeekPos=-1e3,chatOffset=0,htmlMessages=[],loadBack=100,maxOnScreen=150,numDeleteOnOverflow=20;function chatPlayback(){var e=player.getCurrentTime()+chatOffset;(e<lastSeekPos-.1||e>lastSeekPos+12)&&(messageIndex=initChatAtPoint(e)),lastSeekPos=e;for(var t="";messageIndex<numChatMessages&&chatMessages[messageIndex].t<=e;){var a=renderSingleMessage(chatMessages[messageIndex]);htmlMessages.push(a),t+=a,messageIndex++}if(htmlMessages.length>maxOnScreen){htmlMessages=htmlMessages.slice(numDeleteOnOverflow);for(var s="",n=0;n<htmlMessages.length;n++)s+=htmlMessages[n];chatElement.innerHTML=s,scrollDn()}else""!=t&&(chatElement.innerHTML+=t,scrollDn())}function scrollDn(e=!1){setTimeout(()=>{var t=chatElement.parentElement;t.scrollTop=t.scrollHeight+100,e&&setTimeout(()=>{scrollDn(!1)},50)},5)}var loadAheadSecs=1;function initChatAtPoint(e){for(var t=0,a=numChatMessages;t<a;){var s=Math.floor((t+a)/2);chatMessages[s].t<e+loadAheadSecs?t=s+1:a=s}var n=Math.max(0,t-loadBack),l=chatMessages.slice(n,t);console.log("load "+l.length+" msg ["+n+" "+t+"]"),htmlMessages=[];for(var o="",r=0;r<l.length;r++)if(!(l[r].t-chatOffset<0)){var c=renderSingleMessage(l[r]);htmlMessages.push(c),o+=c}return chatElement.innerHTML=o,scrollDn(!0),t}var dontShowChatHeader=!1;function displayChatFull(e,t,a){var s="";dontShowChatHeader||(s+="<h3>"+(a?"All":"Live")+" chat messages</h3>",a||(s+='<a class="shade" href="'+window.location.href+'&vodchat=1">Click here to also include messages posted after the live broadcast</a><br><br>'));for(var n=0,l=0;l<t.length;l++){var o=t[l];(null==o.l||0!=o.l||a)&&(s+=renderSingleMessage(o),n++)}0==n&&(s+='<i style="color: #444;">(no chat messages to display)</i>'),e.innerHTML=s}